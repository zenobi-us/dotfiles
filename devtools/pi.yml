---
actions:
  # Initialize git submodules (e.g., powerline-footer extension)
  - action: command.run
    dir: "{{env.DOTFILE_REPO_ROOT}}"
    command: git
    args:
      - submodule
      - update
      - --init
      - --recursive

  # remove everything except for auth.json and sessions/
  - action: command.run
    command: rm
    where: os.name == "linux" || os.name == "macos"
    args:
      - -rf
      - "{{user.home_dir}}/.pi/agent/AGENT.md"
      - "{{user.home_dir}}/.pi/agent/AGENTS.md"
      - "{{user.home_dir}}/.pi/agent/extensions"
      - "{{user.home_dir}}/.pi/agent/themes"
      - "{{user.home_dir}}/.pi/agent/settings.json"
      - "{{user.home_dir}}/.pi/agent/pi-sub-bar-settings.json"
      - "{{user.home_dir}}/.pi/agent/pi-sub-core-settings.json"
      - "{{user.home_dir}}/.pi/agent/models.json"

  - action: command.run
    where: os.name == "windows"
    command: pwsh
    args:
      - -c
      - |
        remove-item -recurse -force -erroraction SilentlyContinue $env:LOCALAPPDATA/pi
        new-item -path "$env:LOCALAPPDATA/pi" -itemtype symboliclink -value "$(pwd)/devtools/files/pi"

  - action: command.run
    command: mkdir
    where: os.name == "linux" || os.name == "macos"
    args:
      - -p
      - "{{user.home_dir}}/.pi/agent"

  - action: file.link
    to: "{{user.home_dir}}/.pi/agent/extensions"
    from: pi/agent/extensions

  - action: file.link
    to: "{{user.home_dir}}/.pi/agent/AGENTS.md"
    from: pi/agent/AGENTS.md

  - action: file.link
    to: "{{user.home_dir}}/.pi/agent/settings.json"
    from: pi/agent/settings.json

  - action: file.link
    to: "{{user.home_dir}}/.pi/agent/models.json"
    from: pi/agent/models.json

  - action: file.link
    to: "{{user.home_dir}}/.pi/agent/pi-sub-bar-settings.json"
    from: pi/agent/pi-sub-bar-settings.json

  - action: file.link
    to: "{{user.home_dir}}/.pi/agent/pi-sub-core-settings.json"
    from: pi/agent/pi-sub-core-settings.json

  - action: command.run
    dir: "{{user.home_dir}}/.pi"
    command: mise
    args:
      - install
