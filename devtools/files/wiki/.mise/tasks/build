#!/usr/bin/env bash
# Build wiki-cli binary from TypeScript source
# mise usage: build [TARGET]
# Target examples: linux-x64, darwin-arm64, windows-x64

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
TARGET="${1:-}"

echo "Building wiki-cli..."
cd "$SCRIPT_DIR"

BUILD_CMD="bun build ./src/index.ts --compile --outfile wiki"
if [ -n "$TARGET" ]; then
  BUILD_CMD="$BUILD_CMD --target $TARGET"
fi

eval "$BUILD_CMD"

# Make executable
chmod +x wiki-cli

echo "âœ“ wiki-cli built successfully at $SCRIPT_DIR/wiki-cli"
